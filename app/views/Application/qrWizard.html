#{set shop:shop /}
#{set language:language /}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

    <title>Створення QR-коду</title>

    <link href="/wisehands/mainpage/css/reset.css" rel="stylesheet"/>
    <link href="/wisehands/mainpage/css/animate.css" rel="stylesheet"/>
    <link href="/wisehands/mainpage/css/animate.min.css" rel="stylesheet"/>
    <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.0.0/animate.min.css"
    />
    <script src="/wisehands/mainpage/js/wow.min.js"></script>
    <script>
        new WOW().init();
    </script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Muli:wght@500&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Source+Serif+Pro:wght@300;600;700&display=swap" rel="stylesheet">

    <link rel="icon"
          type="image/png"
          href="wisehands/assets/images/favicon.png">
</head>

<style>
    body {
        font-size: 16px;
        font-family: "Source Sans Pro",sans-serif;
        min-width: 320px;
    }

    body a {
        text-decoration: none;
        color: inherit;
    }

    .container {
        max-width: 1200px;
        margin: 0 auto;
        overflow: hidden;
        font-family: "Source Sans Pro",sans-serif;
    }

    .qr-wizard-form {
        display: flex;
        padding: 15px;
        height: 100vh;
    }

    .qr-wizard-sidebar {
        flex: 0 0 35%;
        background-color: #f5f5f5;
        padding-top: 50px;
    }

    .logo {
        display: flex;
        align-items: center;
        margin-left: 50px;
    }

    .logo img {
        width: 40px;
        height: 40px;
        margin-right: 5px;
    }

    .qr-wizard-img {
        display: none;
        width: 220px;
        object-fit: cover;
        margin: 100px auto 10px;
    }

    .qr-wizard-panel {
        flex: 0 0 65%;
        background-color: #f7f7f7;
        padding: 100px 50px;
        position: relative;
    }

    .qr-form h4 {
        margin: 20px 0 5px;
        font-weight: 400;
    }

    .qr-form p {
        font-size: 14px;
        color: #777;
    }

    .qr-form-input {
        padding: 7px 10px;
        width: 100%;
        border: 1px solid #999;
        border-radius: 3px;
    }

    .qr-form input:focus {
        outline: none;
        border: 1px solid #20b2aa;
        box-shadow: 0 0 2px #20b2aa;
    }

    .form-button {
        display: flex;
        justify-content: space-between;
        align-items: center;
        position: absolute;
        width: calc(100% - 100px);
        right: 50px;
        bottom: 100px;
    }

    .form-button p {
        font-size: 14px;
        text-transform: uppercase;
        color: #666;
        transition: 250ms color;
    }

    .form-button p:hover  {
        cursor: pointer;
        color: #000;
    }

    #finishBtn {
        display: none;
    }

    .store-address-block p {
        padding: 15px 0 0 0;
    }

    .store-address {
        font-size: 22px;
    }

    #store-name, #input-store-address {
        color: #888;
    }

    #store-name:focus, #input-store-address:focus {
        color: #000;
    }

    button {
        border: 1px solid #000;
        padding: 5px 25px;
        background-color: #fff;
        transition: 250ms background-color;
    }

    button:hover {
        cursor: pointer;
        background-color: #000;
        color: #fff;
    }

    .page {
        display: none;
    }

    .active-page {
        display: block;
    }

    .active-image {
        display: block;
    }

    .progress-bar-container {
        position: relative;
    }

    .progress-bar-container::before {
        content: "";
        position: absolute;
        height: 10px;
        width: 100%;
        top: 50%;
        left: 0px;
        transform: translateY(-50%);
    }

    #progress-bar {
        position: absolute;
        background-color: #3ec776;
        width: 5px;
        height: 0%;
        top: 0;
        left: 68px;
        transition: 0.3s ease;
    }

    #progress-bar-mob {
        display: none;
        position: absolute;
        background-color: #3ec776;
        height: 7px;
        width: 0%;
        max-width: calc(100% - 20px);
        top: 30px;
        left: 0px;
        transition: 0.3s ease;
        transform: translateY(-50%);
        margin-left: 10px;
    }

    .circles-container {
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        max-width: 100%;
        height: 250px;
        margin: 50px 20px 20px 50px;
    }

    .circle {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        position: relative;
        z-index: 2;
        transition: 0.4s ease;
        background-color: #fff;
    }

    .circle h3 {
        position: absolute;
        left: 37%;
        top: 10%;
        font-size: 20px;
        color: #ccc;
    }

    .circle.active {
        background-color: #3ec776;
    }
    .circle.active h3 {
        color: #fff;
    }

    .qr-circle-title {
        white-space: nowrap;
        position: absolute;
        left: 55px;
        top: 7px;
    }

    .delivery-payment-container {
        display: flex;
        align-items: center;
    }

    .qr-form .error-message {
        visibility: hidden;
        color: red;
    }
    .qr-form-input .error {
        border-color: red;
    }

    .qr-form-input .success {
        border-color: green;
    }

    @media screen and (max-width: 768px) {
        .qr-wizard-form {
            height: 100%;
            min-height: 100vh;
        }

        .qr-wizard-sidebar {
            display: flex;
            flex-direction: column;
            padding: 0;
        }

        .logo {
            justify-content: center;
        }

        .circles-container {
            flex-direction: row;
            height: 70px;
            margin: 10px;
        }

        .qr-circle-title {
            display: none;
        }

        #progress-bar {
            display: none;
        }
        #progress-bar-mob {
            display: block;
        }

        .qr-wizard-form {
            flex-direction: column;
        }


        .qr-wizard-images {
            align-self: center;
            width: 180px;
            height: 180px;
        }

        .qr-wizard-img {
            margin: 10px;
        }

        .qr-wizard-panel {
            padding: 10px;
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            flex: 1 0 60%;
            height: 100%;
        }

        .form-button {
            position: static;
            margin-top: 20px;
            align-self: flex-end;
        }
    }

</style>

<body>
    <div class="container qr-wizard-form">
        <div class="qr-wizard-sidebar">
            <div class="logo">
                <img src="/wisehands/assets/images/wiseblack.png" alt="logo">
                <p>WiseHands</p>
            </div>
            <div class="progress-bar-container">
                <div id="progress-bar"></div>
                <div id="progress-bar-mob"></div>

                <div class="circles-container">
                    <div class="circle active">
                        <h3>1</h3>
                        <p class="qr-circle-title">Реєстрація</p>
                    </div>
                    <div class="circle">
                        <h3>2</h3>
                        <p class="qr-circle-title">Назва</p>
                    </div>
                    <div class="circle">
                        <h3>3</h3>
                        <p class="qr-circle-title">Контакти</p>
                    </div>
                    <div class="circle">
                        <h3>4</h3>
                        <p class="qr-circle-title">Налаштування</p>
                    </div>
                </div>
            </div>
            <div class="qr-wizard-images">
                <img id="qr-step1-img" class="qr-wizard-img  active-image wow zoomIn" src="../wisehands/landing/images/qr_wizard_1.svg" alt="img">
                <img id="qr-step2-img" class="qr-wizard-img  wow zoomIn" src="../wisehands/landing/images/qr_wizard_2.svg" alt="img">
                <img id="qr-step3-img" class="qr-wizard-img  wow zoomIn" src="../wisehands/landing/images/qr_wizard_3.svg" alt="img">
                <img id="qr-step4-img" class="qr-wizard-img  wow zoomIn" src="../wisehands/landing/images/qr_wizard_4.svg" alt="img">
            </div>
        </div>
        <div class="qr-wizard-panel">
            <form id="qr-form" class="qr-form pages" onsubmit="return false">

                <section id="qr-step1" class="qr-step-page qr-step" form-step="1">
                    <h3>Реєстрація</h3>
                    <div class="form-field">
                        <h4>Ім'я</h4>
                        <input class="qr-form-input" id="user-name" type="text" name="name" required="true">
                        <span class="highlight"></span>
                    </div>
                    <div class="form-field">
                        <h4>Прізвище</h4>
                        <input  class="qr-form-input" id="user-surname" type="text" name="surname" required>
                        <span class="highlight"></span>
                    </div>
                    <div class="form-field">
                        <h4>Номер телефону</h4>
                        <input  class="qr-form-input" id="user-phone" type="tel" name="phone" required pattern="^[0-9-+\s()]*$">
                        <span class="highlight"></span>
                    </div>
                    <div class="form-field">
                        <h4>Email</h4>
                        <input  class="qr-form-input" id="user-email" type="email" name="email" required>
                        <p class="error-message">Error message</p>
                        <span class="highlight"></span>
                    </div>
                    <div class="form-field">
                        <h4>Пароль</h4>
                        <input  class="qr-form-input" id="user-password" type="password" name="password" required>
                        <span class="highlight"></span>
                    </div>
                    <div class="form-oferta">
                        <p>Реєструючись, ви погоджуєтесь з умовами <a href="/contract">Публічної оферти та Умовами надання послуг WiseStore</a>
                        </p>
                    </div>
                </section>

                <section id="qr-step2" class="qr-step-page qr-step2" form-step="2" hidden>
                    <h3>Назва магазину і сайту</h3>
                    <h4>Введіть назву магазину</h4>
                    <input   class="qr-form-input" type="text" id="store-name" name="shopName"
                             placeholder="введіть назву" required
                             onblur="setShopNameForShop(event)">
                    <h4>Введіть адресу сайту</h4>
                    <input  class="qr-form-input" type="text" id="input-store-address" name="shopDomain" placeholder="введіть адресу" required
                            onblur="checkDomainNameAvailability(event)">
                    <div class="store-address-block">
                        <p>Ваша адреса сайту:</p>
                        <div class='store-address' id='store-name-address'></div>
                        <p id="store-domain-error"></p>
                    </div>
                </section>

                <section id="qr-step3" class="qr-step-page qr-step3" form-step="3" hidden>
                    <h3>Додайте контакти</h3>
                    <h4>Місто</h4>
                    <input  class="qr-form-input" type="text"
                            id="city-name" name="cityName"
                            placeholder="введіть назву міста"
                            required>
                    <h4>Вулиця</h4>
                    <input  class="qr-form-input" type="text"
                            id="street-name" name="streetName"
                            placeholder="введіть вулицю"
                            required>
                    <h4>Будинок</h4>
                    <input  class="qr-form-input"  type="text"
                            id="house-number" name="buildingNumber"
                            placeholder="введіть номер будинку"
                            required>
                </section>

                <section id="qr-step4" class="qr-step-page qr-step4" form-step="4" hidden>
                    <div class="qr-wizard-delivery">
                        <h3>Добавте налаштування</h3>
                        <h4>Виберіть варіанти отримання товару клієнтом</h4>
                        <div class="delivery-payment-container">
                            <div>
                                <input type="checkbox" id="wizardСourier" name="courier" value="courier">
                                <label for="wizardСourier">Кур'єр</label><br>
                                <input type="checkbox" id="wizardPost" name="novaposhta" value="novaposhta">
                                <label for="wizardPost">Нова пошта</label><br>
                                <input type="checkbox" id="wizardSelftake" name="self" value="self">
                                <label for="wizardSelftake">Самовивіз</label><br>
                            </div>
                        </div>
                        <h4>Виберіть варіанти оплати</h4>
                        <div class="delivery-payment-container">
                            <div>
                                <input type="checkbox" id="qrCash" name="courier" value="cash">
                                <label for="wizardСourier">Готівка</label><br>
                                <input type="checkbox" id="qrOnlinePayment" name="onlinepayment" value="novaposhta">
                                <label for="wizardPost">Онлайн оплата</label><br>
                            </div>
                        </div>
                    </div>
                </section>
                <div class="form-button">
                    <p id="previousBtn" class="previous-step-button" onclick="previousStep()" hidden>Попередній крок</p>
                    <button id="nextBtn" type="submit" class="next-step-button" onclick="proceedNext()">Далі</button>
                </div>
            </form>

        </div>
    </div>

<script>

    const  previousBtn  =  document.getElementById('previousBtn');
    const  nextBtn  =  document.getElementById('nextBtn');

    let circleActive = document.querySelector(".active");

    const progressBar = document.getElementById("progress-bar");
    const progressBarMob = document.getElementById("progress-bar-mob");
    const screenSizeMobile = 768;

    let currentFormStep = 1;
    previousBtn.hidden = true;

    const wizardForms = document.querySelectorAll('section');
    const currentStepIndicators = document.querySelectorAll(".circle");

    const requiredFields = document.querySelectorAll('[required]');
    requiredFields.forEach(requiredField => {
	    requiredField.addEventListener('input', event => event.target.setCustomValidity(''));
    });


    function proceedNext() {
    	console.log("proceedNext");
	    if (!validateCurrentForm()) return;

	    circleActive = circleActive.nextElementSibling;
	    if (currentFormStep !== 4) circleActive.classList.add("active");

	    switch (currentFormStep) {
		    case 1:
			    console.log(1);
			    currentFormStep++;
			    setCurrentFormAndFormStepIndicator();
			    // registerUser();
			    break;
		    case 2:
			    console.log(2);
			    currentFormStep++;
			    setCurrentFormAndFormStepIndicator();
			    break;
		    case 3:
			    console.log(3);
			    setShopContactInfo();
			    currentFormStep++;
			    setCurrentFormAndFormStepIndicator();
			    break;
		    case 4:
			    console.log(4);
			    // settingVariantsOfDeliveryAndPaymentTypes();
			    currentFormStep++;
			    setCurrentFormAndFormStepIndicator();
			    break;
	    }

	    setIsPreviousStepButtonHidden();
	    setNextButtonLabel();

	    if (screen.width <= screenSizeMobile) {
		    updateProgressBarMob();
	    }
	    if (screen.width > screenSizeMobile) {
		    updateProgressBar();
	    }
    }

    function previousStep() {
	    circleActive.classList.remove("active");
	    circleActive = circleActive.previousElementSibling;

	    currentFormStep--;
	    setCurrentFormAndFormStepIndicator();
	    setIsPreviousStepButtonHidden();
	    setNextButtonLabel();

	    if (screen.width <= screenSizeMobile) {
		    updateProgressBarMob();
	    }
	    if (screen.width >= screenSizeMobile) {
		    updateProgressBar();
	    }
    }

    function validateCurrentForm() {
	    const currentForm = document.querySelector('section[form-step="' + currentFormStep + '"]');
	    const currentFormInputs = currentForm.querySelectorAll('[required]');
	    let validInputs = 0;
	    currentFormInputs.forEach(input => {
		    input.value.trim() ? input.setCustomValidity('') : input.setCustomValidity('Заповніть, будь ласка, це поле');
		    if (input.value.trim()) validInputs++;
	    });
	    return validInputs === currentFormInputs.length;
    }
    function setCurrentFormAndFormStepIndicator() {
	    wizardForms.forEach(form => {
		    const formStep = form.getAttribute('form-step');
		    const isCurrentFormStepEqualsDisplayedFormStep = currentFormStep === Number(formStep);
		    form.hidden = !isCurrentFormStepEqualsDisplayedFormStep;
	    });

	    currentStepIndicators.forEach((currentStepIndicator, index) => {
		    const isCurrentStepIndicatorIndexEqualsToCurrentFormStep = index + 1 === currentFormStep;
		    !isCurrentStepIndicatorIndexEqualsToCurrentFormStep ? currentStepIndicator.classList.remove('active-image') : currentStepIndicator.classList.add('active-image');

	    });
    }
    function setIsPreviousStepButtonHidden() {
	    previousBtn.hidden = currentFormStep === 1;
    }
    function setNextButtonLabel() {
	    const isLastSTep = currentFormStep === 4;
	    nextBtn.innerHTML = isLastSTep ? 'Готово' : 'Далі';
    }

    function updateProgressBar() {
        const actives = document.querySelectorAll(".active");
        const currentHeight = ((actives.length - 1) / (currentStepIndicators.length - 1)) * 100;
        progressBar.style.height = currentHeight + "%";

    }
    function updateProgressBarMob() {
        const actives = document.querySelectorAll(".active");
        const currentWidth = ((actives.length - 1) / (currentStepIndicators.length - 1)) * 100;
        progressBarMob.style.width = currentWidth + "%";
    }

    function registerUser() {
	    console.log("registerUser");
	    let name = document.getElementById('user-name').value;
	    let lastName = document.getElementById('user-surname').value;
	    let phone = document.getElementById('user-phone').value;
	    let email = document.getElementById('user-email').value;
	    let password = document.getElementById('user-password').value;
	    let clientInfo = {
		    name: name,
		    lastName: lastName,
		    phone: phone,
		    email: email,
		    password: password
	    };
	    let params = JSON.stringify(clientInfo);
	    console.log('params', params);
	    // fetch('/api/sign-up', {
	    //  method: 'POST',
	    //  body: params
	    // }).then(function (response) {
	    //  if(response.ok) {
	    //    let token = response.headers.get('JWT_TOKEN');
	    //    localStorage.setItem('JWT_TOKEN', token);
	    //  }
	    //  return response.json();
	    // }).then(function (data) {
	    //  console.log("response data: ", data);
	    //  // checkUserByEmailOrPhoneNumber(data);
       // currentFormStep++;
       // setCurrentFormAndFormStepIndicator();
	    // });
    }

    function setShopNameForShop(event) {
	    localStorage.setItem('isShopCreated', 'true');
	    console.log('setShopNameForShop: ', event.target.name, event.target.value);
	    const params = '?' + event.target.name + '=' + event.target.value;
	    const url = '/api/wizard/update' + params;
	    _generateRequest(url);
    }
    function checkDomainNameAvailability(event) {
	    const params = '?' + event.target.name + '=' + event.target.value;
	    console.log('checkDomainNameAvailability => ', params);
	    const url = '/api/wizard/check-domain-name' + params;
	    _generateRequest(url);
    }

    function setShopContactInfo() {
	    let city = document.getElementById('city-name').value;
	    let street = document.getElementById('street-name').value;
	    let house = document.getElementById('house-number').value;
	    let json = JSON.stringify({city:city, street:street, house:house});
	    const url = '/api/wizard/shop-contact-info';
	    console.log('setShopContactInfo =>', url, json);
	    _generateRequest(url, json);
    }

    function _generateRequest(url, json) {
	    let token = localStorage.getItem('JWT_TOKEN');
	    // const isUrlEqualDelivPayType = url == urlForDeliveryPaymentType;
	    // console.log("check isUrlEqualDelivPayType for creating shop: ", isUrlEqualDelivPayType);
	    fetch(url, {
		    method: 'POST',
		    body: json,
		    headers: {
			    authorization: 'Bearer ' + token
		    }
	    }).then(function (response) {
		    console.log("response response: ", response);
		    return response.json();
	    }).then(function (data) {
		    console.log("response to prepare for creating shop: ", data);
		    // handlingErrorForDomainName(data);
		    // if (data && isUrlEqualDelivPayType) {
			   //  setTimeout(function() {
				 //    generateRequestForCreatingShop().then(() => window.location = '/dashboard');
			   //  },10000);
		    // }
	    });
    }

    function handlingErrorForDomainName(data) {
	    const containerError = document.getElementById('store-domain-error');
	    if (data.status === 420) {
		    containerError.style.display = "block";
		    containerError.innerText = data.message;
		    isValidateAddressDomainName = false;
	    }
	    if (data.status === 421) {
		    containerError.style.display = "none";
		    isValidateAddressDomainName = true;

	    }
    }

    let inputName = document.getElementById('input-store-address');
    inputName.onkeyup = function(){
        document.getElementById('store-name-address').innerHTML = inputName.value + '.wstore.pro';
    };

    function showError(input, message) {
        const formControl = input.parentElement;
        formControl.className = 'qr-form-input error';
        const errorMessage = formControl.querySelector('error-message');
        errorMessage.innerText = message;
    }
    function showSuccess(input) {
        const formControl = input.parentElement;
        formControl.className = 'qr-form-input success';
    }
    function checkEmail(input) {
        const re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
        if (re.test(input.value.trim())) {
            showSuccess(input);
        } else {
            showError(input, 'Email is not valid');
        }
    }

</script>
    </body>
    </html>