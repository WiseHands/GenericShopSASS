#{set shop:shop /}
#{set language:language /}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

    <title>Створення QR-коду</title>

    <link href="/wisehands/mainpage/css/reset.css" rel="stylesheet"/>
    <link href="/wisehands/mainpage/css/animate.css" rel="stylesheet"/>
    <link href="/wisehands/mainpage/css/animate.min.css" rel="stylesheet"/>
    <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.0.0/animate.min.css"
    />
    <script src="/wisehands/mainpage/js/wow.min.js"></script>
    <script>
        new WOW().init();
    </script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Muli:wght@500&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Source+Serif+Pro:wght@300;600;700&display=swap" rel="stylesheet">

    <link rel="icon"
          type="image/png"
          href="wisehands/assets/images/favicon.png">
</head>

<style>
    body {
        font-size: 16px;
        font-family: "Source Sans Pro",sans-serif;
        min-width: 320px;
    }

    body a {
        text-decoration: none;
        color: inherit;
    }

    .container {
        max-width: 1200px;
        margin: 0 auto;
        overflow: hidden;
        font-family: "Source Sans Pro",sans-serif;
    }

    .qr-wizard-form {
        display: flex;
        padding: 15px;
        height: 100vh;
    }

    .qr-wizard-sidebar {
        flex: 0 0 35%;
        background-color: #f5f5f5;
        padding-top: 50px;
    }

    .logo {
        display: flex;
        align-items: center;
        margin-left: 50px;
    }

    .logo img {
        width: 40px;
        height: 40px;
        margin-right: 5px;
    }

    .qr-wizard-img {
        display: none;
        width: 220px;
        object-fit: cover;
        margin: 100px auto 10px;
    }

    .qr-wizard-panel {
        flex: 0 0 65%;
        background-color: #f7f7f7;
        padding: 100px 50px;
        position: relative;
    }

    .qr-form h4 {
        margin: 20px 0 5px;
        font-weight: 400;
    }

    .qr-form p {
        font-size: 14px;
        color: #777;
    }

    .qr-form-input {
        padding: 7px 10px;
        width: 100%;
        border: 1px solid #999;
        border-radius: 3px;
    }

    .qr-form input:focus {
        outline: none;
        border: 1px solid #20b2aa;
        box-shadow: 0 0 2px #20b2aa;
    }

    .form-button {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin: 10px 0;        
        right: 50px;
        bottom: 100px;
    }

    .form-button p {
        font-size: 14px;
        text-transform: uppercase;
        color: #666;
        transition: 250ms color;
    }

    .form-button p:hover  {
        cursor: pointer;
        color: #000;
    }

    #finishBtn {
        display: none;
    }

    .store-address-block p {
        padding: 15px 0 0 0;
    }

    .store-address {
        font-size: 22px;
    }

    #store-name, #domain-address {
        color: #888;
    }

    #store-name:focus, #domain-address:focus {
        color: #000;
    }

    button {
        border: 1px solid #000;
        padding: 5px 25px;
        background-color: #fff;
        transition: 250ms background-color;
    }

    button:hover {
        cursor: pointer;
        background-color: #000;
        color: #fff;
    }

    .page {
        display: none;
    }

    .active-page {
        display: block;
    }

    .active-image {
        display: block;
    }

    .progress-bar-container {
        position: relative;
    }

    .progress-bar-container::before {
        content: "";
        position: absolute;
        height: 10px;
        width: 100%;
        top: 50%;
        left: 0px;
        transform: translateY(-50%);
    }

    #progress-bar {
        position: absolute;
        background-color: #3ec776;
        width: 5px;
        height: 0%;
        top: 0;
        left: 68px;
        transition: 0.3s ease;
    }

    #progress-bar-mob {
        display: none;
        position: absolute;
        background-color: #3ec776;
        height: 7px;
        width: 0%;
        max-width: calc(100% - 20px);
        top: 30px;
        left: 0px;
        transition: 0.3s ease;
        transform: translateY(-50%);
        margin-left: 10px;
    }

    .circles-container {
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        max-width: 100%;
        height: 250px;
        margin: 50px 20px 20px 50px;
    }

    .circle {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        position: relative;
        z-index: 2;
        transition: 0.4s ease;
        background-color: #fff;
    }

    .circle h3 {
        position: absolute;
        left: 37%;
        top: 10%;
        font-size: 20px;
        color: #ccc;
    }

    .circle.active {
        background-color: #3ec776;
    }
    .circle.active h3 {
        color: #fff;
    }

    .qr-circle-title {
        white-space: nowrap;
        position: absolute;
        left: 55px;
        top: 7px;
    }

    .delivery-payment-container {
        display: flex;
        align-items: center;
    }

    #handle-delivery-error {
      color: red;
      margin-bottom: 0;
      margin-left: 60px;
    }

    .qr-form .error-message {
        visibility: hidden;
        color: red;
    }
    .qr-form-input .error {
        border-color: red;
    }

    .qr-form-input .success {
        border-color: green;
    }

    .registration-title-container {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    /*start circle loading animation*/

    .circle-loading-animation {
      margin-top: 20%;
      margin-left: 40%;
      position: relative;
      width: 120px;
      height:120px;
    }

    .circle-loading-animation .wBall {
      position: absolute;
      width: 114px;
      height: 114px;
      opacity: 0;
      transform: rotate(225deg);
      -o-transform: rotate(225deg);
      -ms-transform: rotate(225deg);
      -webkit-transform: rotate(225deg);
      -moz-transform: rotate(225deg);
      animation: orbit 4.5325s infinite;
      -o-animation: orbit 4.5325s infinite;
      -ms-animation: orbit 4.5325s infinite;
      -webkit-animation: orbit 4.5325s infinite;
      -moz-animation: orbit 4.5325s infinite;
    }

    .circle-loading-animation .wBall .wInnerBall{
      position: absolute;
      width: 15px;
      height: 15px;
      background: rgb(0,0,0);
      left:0px;
      top:0px;
      border-radius: 15px;
    }

    .circle-loading-animation #wBall_1 {
      animation-delay: 0.986s;
      -o-animation-delay: 0.986s;
      -ms-animation-delay: 0.986s;
      -webkit-animation-delay: 0.986s;
      -moz-animation-delay: 0.986s;
    }

    .circle-loading-animation #wBall_2 {
      animation-delay: 0.193s;
      -o-animation-delay: 0.193s;
      -ms-animation-delay: 0.193s;
      -webkit-animation-delay: 0.193s;
      -moz-animation-delay: 0.193s;
    }

    .circle-loading-animation #wBall_3 {
      animation-delay: 0.3965s;
      -o-animation-delay: 0.3965s;
      -ms-animation-delay: 0.3965s;
      -webkit-animation-delay: 0.3965s;
      -moz-animation-delay: 0.3965s;
    }

    .circle-loading-animation #wBall_4 {
      animation-delay: 0.5895s;
      -o-animation-delay: 0.5895s;
      -ms-animation-delay: 0.5895s;
      -webkit-animation-delay: 0.5895s;
      -moz-animation-delay: 0.5895s;
    }

    .circle-loading-animation #wBall_5 {
      animation-delay: 0.793s;
      -o-animation-delay: 0.793s;
      -ms-animation-delay: 0.793s;
      -webkit-animation-delay: 0.793s;
      -moz-animation-delay: 0.793s;
    }

    @keyframes orbit {
      0% {
        opacity: 1;
        z-index:99;
        transform: rotate(180deg);
        animation-timing-function: ease-out;
      }

      7% {
        opacity: 1;
        transform: rotate(300deg);
        animation-timing-function: linear;
        origin:0%;
      }

      30% {
        opacity: 1;
        transform:rotate(410deg);
        animation-timing-function: ease-in-out;
        origin:7%;
      }

      39% {
        opacity: 1;
        transform: rotate(645deg);
        animation-timing-function: linear;
        origin:30%;
      }

      70% {
        opacity: 1;
        transform: rotate(770deg);
        animation-timing-function: ease-out;
        origin:39%;
      }

      75% {
        opacity: 1;
        transform: rotate(900deg);
        animation-timing-function: ease-out;
        origin:70%;
      }

      76% {
        opacity: 0;
        transform:rotate(900deg);
      }

      100% {
        opacity: 0;
        transform: rotate(900deg);
      }
    }

    @-o-keyframes orbit {
      0% {
        opacity: 1;
        z-index:99;
        -o-transform: rotate(180deg);
        -o-animation-timing-function: ease-out;
      }

      7% {
        opacity: 1;
        -o-transform: rotate(300deg);
        -o-animation-timing-function: linear;
        -o-origin:0%;
      }

      30% {
        opacity: 1;
        -o-transform:rotate(410deg);
        -o-animation-timing-function: ease-in-out;
        -o-origin:7%;
      }

      39% {
        opacity: 1;
        -o-transform: rotate(645deg);
        -o-animation-timing-function: linear;
        -o-origin:30%;
      }

      70% {
        opacity: 1;
        -o-transform: rotate(770deg);
        -o-animation-timing-function: ease-out;
        -o-origin:39%;
      }

      75% {
        opacity: 1;
        -o-transform: rotate(900deg);
        -o-animation-timing-function: ease-out;
        -o-origin:70%;
      }

      76% {
        opacity: 0;
        -o-transform:rotate(900deg);
      }

      100% {
        opacity: 0;
        -o-transform: rotate(900deg);
      }
    }

    @-ms-keyframes orbit {
      0% {
        opacity: 1;
        z-index:99;
        -ms-transform: rotate(180deg);
        -ms-animation-timing-function: ease-out;
      }

      7% {
        opacity: 1;
        -ms-transform: rotate(300deg);
        -ms-animation-timing-function: linear;
        -ms-origin:0%;
      }

      30% {
        opacity: 1;
        -ms-transform:rotate(410deg);
        -ms-animation-timing-function: ease-in-out;
        -ms-origin:7%;
      }

      39% {
        opacity: 1;
        -ms-transform: rotate(645deg);
        -ms-animation-timing-function: linear;
        -ms-origin:30%;
      }

      70% {
        opacity: 1;
        -ms-transform: rotate(770deg);
        -ms-animation-timing-function: ease-out;
        -ms-origin:39%;
      }

      75% {
        opacity: 1;
        -ms-transform: rotate(900deg);
        -ms-animation-timing-function: ease-out;
        -ms-origin:70%;
      }

      76% {
        opacity: 0;
        -ms-transform:rotate(900deg);
      }

      100% {
        opacity: 0;
        -ms-transform: rotate(900deg);
      }
    }

    @-webkit-keyframes orbit {
      0% {
        opacity: 1;
        z-index:99;
        -webkit-transform: rotate(180deg);
        -webkit-animation-timing-function: ease-out;
      }

      7% {
        opacity: 1;
        -webkit-transform: rotate(300deg);
        -webkit-animation-timing-function: linear;
        -webkit-origin:0%;
      }

      30% {
        opacity: 1;
        -webkit-transform:rotate(410deg);
        -webkit-animation-timing-function: ease-in-out;
        -webkit-origin:7%;
      }

      39% {
        opacity: 1;
        -webkit-transform: rotate(645deg);
        -webkit-animation-timing-function: linear;
        -webkit-origin:30%;
      }

      70% {
        opacity: 1;
        -webkit-transform: rotate(770deg);
        -webkit-animation-timing-function: ease-out;
        -webkit-origin:39%;
      }

      75% {
        opacity: 1;
        -webkit-transform: rotate(900deg);
        -webkit-animation-timing-function: ease-out;
        -webkit-origin:70%;
      }

      76% {
        opacity: 0;
        -webkit-transform:rotate(900deg);
      }

      100% {
        opacity: 0;
        -webkit-transform: rotate(900deg);
      }
    }

    @-moz-keyframes orbit {
      0% {
        opacity: 1;
        z-index:99;
        -moz-transform: rotate(180deg);
        -moz-animation-timing-function: ease-out;
      }

      7% {
        opacity: 1;
        -moz-transform: rotate(300deg);
        -moz-animation-timing-function: linear;
        -moz-origin:0%;
      }

      30% {
        opacity: 1;
        -moz-transform:rotate(410deg);
        -moz-animation-timing-function: ease-in-out;
        -moz-origin:7%;
      }

      39% {
        opacity: 1;
        -moz-transform: rotate(645deg);
        -moz-animation-timing-function: linear;
        -moz-origin:30%;
      }

      70% {
        opacity: 1;
        -moz-transform: rotate(770deg);
        -moz-animation-timing-function: ease-out;
        -moz-origin:39%;
      }

      75% {
        opacity: 1;
        -moz-transform: rotate(900deg);
        -moz-animation-timing-function: ease-out;
        -moz-origin:70%;
      }

      76% {
        opacity: 0;
        -moz-transform:rotate(900deg);
      }

      100% {
        opacity: 0;
        -moz-transform: rotate(900deg);
      }
    }

    @media screen and (max-width: 1100px){
      .circle-loading-animation{
        margin-top: 20%;
      }
      .wizard-form{
        width: 100%;
        height: 100%;
        margin: 0;
      }
    }


    /*end circle loading animation*/

    @media screen and (max-width: 768px) {
        .circle-loading-animation{
          margin-left: 30%;
        }
        .qr-wizard-form {
            height: 100%;
            min-height: 100vh;
        }

        .qr-wizard-sidebar {
            display: flex;
            flex-direction: column;
            padding: 0;
        }

        .logo {
            justify-content: center;
        }

        .circles-container {
            flex-direction: row;
            height: 70px;
            margin: 10px;
        }

        .qr-circle-title {
            display: none;
        }

        #progress-bar {
            display: none;
        }
        #progress-bar-mob {
            display: block;
        }

        .qr-wizard-form {
            flex-direction: column;
        }


        .qr-wizard-images {
            align-self: center;
            width: 180px;
            height: 180px;
        }

        .qr-wizard-img {
            margin: 10px;
        }

        .qr-wizard-panel {
            padding: 10px;
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            flex: 1 0 60%;
            height: 100%;
        }

        .form-button {
            position: static;
            margin-top: 20px;
            align-self: flex-end;
        }
    }

</style>

<body>
    <div class="container qr-wizard-form">
        <div class="qr-wizard-sidebar">
            <div class="logo">
                <img src="/wisehands/assets/images/wiseblack.png" alt="logo">
                <p>WiseHands</p>
            </div>
            <div class="progress-bar-container">
                <div id="progress-bar"></div>
                <div id="progress-bar-mob"></div>

                <div class="circles-container">
                    <div class="circle active">
                        <h3>1</h3>
                        <p class="qr-circle-title">Реєстрація</p>
                    </div>
                    <div class="circle">
                        <h3>2</h3>
                        <p class="qr-circle-title">Назва</p>
                    </div>
                    <div class="circle">
                        <h3>3</h3>
                        <p class="qr-circle-title">Контакти</p>
                    </div>
                    <div class="circle">
                        <h3>4</h3>
                        <p class="qr-circle-title">Налаштування</p>
                    </div>
                </div>
            </div>
            <div class="qr-wizard-images">
                <img id="qr-step1-img" class="qr-wizard-img  active-image wow zoomIn" src="../wisehands/landing/images/qr_wizard_1.svg" alt="img">
                <img id="qr-step2-img" class="qr-wizard-img  wow zoomIn" src="../wisehands/landing/images/qr_wizard_2.svg" alt="img">
                <img id="qr-step3-img" class="qr-wizard-img  wow zoomIn" src="../wisehands/landing/images/qr_wizard_3.svg" alt="img">
                <img id="qr-step4-img" class="qr-wizard-img  wow zoomIn" src="../wisehands/landing/images/qr_wizard_4.svg" alt="img">
            </div>
        </div>
        <div class="qr-wizard-panel">
            <form id="qr-form" class="qr-form pages" onsubmit="return false">

                <section id="qr-step1" class="qr-step-page qr-step" form-step="1">
                    <div class="registration-title-container">
                      <h3>Реєстрація</h3>
                      <span id="show-user-error" hidden></span>
                    </div>
                    <div class="form-field">
                        <h4>Ім'я</h4>
                        <input class="qr-form-input" id="user-name" type="text" name="name" required="true">
                        <span class="highlight"></span>
                    </div>
                    <div class="form-field">
                        <h4>Прізвище</h4>
                        <input  class="qr-form-input" id="user-surname" type="text" name="surname" required>
                        <span class="highlight"></span>
                    </div>
                    <div class="form-field">
                        <h4>Номер телефону</h4>
                        <input  class="qr-form-input" id="user-phone" type="tel" name="phone" required pattern="^[0-9-+\s()]*$">
                        <span class="highlight"></span>
                    </div>
                    <div class="form-field">
                        <h4>Email</h4>
                        <input  class="qr-form-input" id="user-email" type="email" name="email" required>
                        <p class="error-message">Error message</p>
                        <span class="highlight"></span>
                    </div>
                    <div class="form-field">
                        <h4>Пароль</h4>
                        <input  class="qr-form-input" id="user-password" type="password" name="password" required>
                        <span class="highlight"></span>
                    </div>
                    <div class="form-oferta">
                        <p>Реєструючись, ви погоджуєтесь з умовами <a href="/contract">Публічної оферти та Умовами надання послуг WiseStore</a>
                        </p>
                    </div>
                </section>

                <section id="qr-step2" class="qr-step-page qr-step2" form-step="2" hidden>
                    <h3>Назва магазину і сайту</h3>
                    <h4>Введіть назву магазину</h4>
                    <input   class="qr-form-input" type="text" id="store-name" name="shopName"
                             placeholder="введіть назву" required>
                    <h4>Введіть адресу сайту</h4>
                    <input  class="qr-form-input" type="text" id="domain-address" name="shopDomain"
                            placeholder="введіть адресу" required>
                    <div class="store-address-block" hidden>
                        <p>Ваша адреса сайту:</p>
                        <div class='store-address' id='store-domain-address'></div>
                        <p id="store-domain-error"></p>
                    </div>
                </section>

                <section id="qr-step3" class="qr-step-page qr-step3" form-step="3" hidden>
                    <h3>Додайте контакти</h3>
                    <h4>Місто</h4>
                    <input  class="qr-form-input" type="text"
                            id="city-name" name="cityName"
                            placeholder="введіть назву міста"
                            required>
                    <h4>Вулиця</h4>
                    <input  class="qr-form-input" type="text"
                            id="street-name" name="streetName"
                            placeholder="введіть вулицю"
                            required>
                    <h4>Будинок</h4>
                    <input  class="qr-form-input"  type="text"
                            id="house-number" name="buildingNumber"
                            placeholder="введіть номер будинку"
                            required>
                </section>

                <section id="qr-step4" class="qr-step-page qr-step4" form-step="4" hidden>
                    <div class="qr-wizard-delivery">
                        <h3>Добавте налаштування</h3>
                        <h4>Виберіть варіанти отримання товару клієнтом</h4>
                        <div class="delivery-payment-container">
                            <div>
                                <input type="checkbox" id="courier" name="courier" value="courier">
                                <label for="courier">Кур'єр</label><br>
                                <input type="checkbox" id="post" name="novaposhta" value="novaposhta">
                                <label for="post">Нова пошта</label><br>
                                <input type="checkbox" id="selftake" name="self" value="self">
                                <label for="selftake">Самовивіз</label><br>
                            </div>
                            <div>
                              <p id="handle-delivery-error"></p>
                            </div>
                        </div>
                        <h4>Виберіть варіанти оплати</h4>
                        <div class="delivery-payment-container">
                            <div>
                                <input type="checkbox" id="cash" name="courier" value="cash">
                                <label for="cash">Готівка</label><br>
                                <input type="checkbox" id="online-payment" name="onlinepayment" value="novaposhta">
                                <label for="online-payment">Онлайн оплата</label><br>
                            </div>
                        </div>
                    </div>
                </section>
                <div class="form-button">
                    <p id="previousBtn" class="previous-step-button" onclick="previousStep()" hidden>Попередній крок</p>
                    <button id="nextBtn" type="submit" class="next-step-button" onclick="proceedNext(event)">Далі</button>
                </div>
            </form>
            <div class="circle-loading-animation" hidden>
                <div class="wBall" id="wBall_1">
                  <div class="wInnerBall"></div>
                </div>
                <div class="wBall" id="wBall_2">
                  <div class="wInnerBall"></div>
                </div>
                <div class="wBall" id="wBall_3">
                  <div class="wInnerBall"></div>
                </div>
                <div class="wBall" id="wBall_4">
                  <div class="wInnerBall"></div>
                </div>
                <div class="wBall" id="wBall_5">
                  <div class="wInnerBall"></div>
                </div>
            </div>
        </div>
    </div>

<script>

    let circleActive = document.querySelector('.active');
    const circleLoadingAnimation = document.querySelector('.circle-loading-animation');
    const urlForDeliveryPaymentType = '/api/wizard/delivery-payment-info';

    const  previousBtn  =  document.querySelector('#previousBtn');
    previousBtn.hidden = true;
    const  nextBtn  =  document.querySelector('#nextBtn');

    const progressBar = document.querySelector('#progress-bar');
    const progressBarMob = document.querySelector('#progress-bar-mob');
    const screenSizeMobile = 768;

    let currentFormStep = 1;
    const form = document.querySelector('form');
    const formList = document.querySelectorAll('section');
    const currentStepIndicators = document.querySelectorAll(".circle");

    const requiredFields = document.querySelectorAll('[required]');
    requiredFields.forEach(requiredField => {
	    requiredField.addEventListener('input', event => event.target.setCustomValidity(''));
    });


    proceedNext = (event) => {
    	console.log("proceedNext", currentFormStep);
	    event.preventDefault();
	    if (!validateCurrentForm()) return;

	    circleActive = circleActive.nextElementSibling;
	    if (currentFormStep !== 4) circleActive.classList.add("active");

	    switch (currentFormStep) {
		    case 1:
			    console.log(1);
			    currentFormStep++;

			    registerUser();
			    break;
		    case 2:
			    console.log(2);
			    currentFormStep++;

			    checkDomainNameAvailability();
			    break;
		    case 3:
			    console.log(3);
			    currentFormStep++;

			    setShopContactInfo();
			    break;
		    case 4:
			    console.log(4);
			    setCurrentFormAndFormStepIndicator();
			    settingVariantsOfDeliveryAndPaymentTypes();
			    showLoadingCircleAnimation();
			    break;
	    }

	    setIsPreviousStepButtonHidden();
	    setNextButtonLabel();

	    if (screen.width <= screenSizeMobile) {
		    updateProgressBarMob();
	    }
	    if (screen.width > screenSizeMobile) {
		    updateProgressBar();
	    }
    }

    previousStep = () => {
	    circleActive.classList.remove("active");
	    circleActive = circleActive.previousElementSibling;

	    currentFormStep--;
	    setCurrentFormAndFormStepIndicator();
	    setIsPreviousStepButtonHidden();
	    setNextButtonLabel();

	    if (screen.width <= screenSizeMobile) {
		    updateProgressBarMob();
	    }
	    if (screen.width >= screenSizeMobile) {
		    updateProgressBar();
	    }
    }

    validateCurrentForm = () => {
	    const currentForm = document.querySelector('section[form-step="' + currentFormStep + '"]');
	    const currentFormInputs = currentForm.querySelectorAll('[required]');
	    let validInputs = 0;
	    currentFormInputs.forEach(input => {
		    input.value.trim() ? input.setCustomValidity('') : input.setCustomValidity('Заповніть, будь ласка, це поле');
		    if (input.value.trim()) validInputs++;
	    });
	    return validInputs === currentFormInputs.length;
    }
    setCurrentFormAndFormStepIndicator = () => {
	    formList.forEach(form => {
		    const formStep = form.getAttribute('form-step');
		    const isCurrentFormStepEqualsDisplayedFormStep = currentFormStep === Number(formStep);
		    form.hidden = !isCurrentFormStepEqualsDisplayedFormStep;
	    });

	    currentStepIndicators.forEach((currentStepIndicator, index) => {
		    const isCurrentStepIndicatorIndexEqualsToCurrentFormStep = index + 1 === currentFormStep;
		    !isCurrentStepIndicatorIndexEqualsToCurrentFormStep ? currentStepIndicator.classList.remove('active-image') : currentStepIndicator.classList.add('active-image');

	    });
    }
    setIsPreviousStepButtonHidden = () => {
	    previousBtn.hidden = currentFormStep === 1;
    }
    setNextButtonLabel = () => {
	    const isLastSTep = currentFormStep === 4;
	    previousBtn.hidden = isLastSTep;
	    nextBtn.innerHTML = isLastSTep ? 'Готово' : 'Далі';
    }

    updateProgressBar = () => {
        const actives = document.querySelectorAll(".active");
        const currentHeight = ((actives.length - 1) / (currentStepIndicators.length - 1)) * 100;
        progressBar.style.height = currentHeight + "%";

    }
    updateProgressBarMob = () => {
        const actives = document.querySelectorAll(".active");
        const currentWidth = ((actives.length - 1) / (currentStepIndicators.length - 1)) * 100;
        progressBarMob.style.width = currentWidth + "%";
    }

    registerUser = () => {
	    console.log("registerUser");
	    let name = document.querySelector('#user-name').value;
	    let lastName = document.querySelector('#user-surname').value;
	    let phone = document.querySelector('#user-phone').value;
	    let email = document.querySelector('#user-email').value;
	    let password = document.querySelector('#user-password').value;
	    let clientInfo = {
		    name: name,
		    lastName: lastName,
		    phone: phone,
		    email: email,
		    password: password
	    };
	    let params = JSON.stringify(clientInfo);
	    console.log('params', params);
	    fetch('/api/sign-up', {
	     method: 'POST',
	     body: params
	    }).then(response => {
	     if(response.ok) {
	       let token = response.headers.get('JWT_TOKEN');
	       localStorage.setItem('JWT_TOKEN', token);
	     }
	     return response.json();
	    }).then(data => {
	     console.log("response data: ", data);
	     checkUserByEmailOrPhoneNumber(data);
	    });
    }

    checkUserByEmailOrPhoneNumber = (data) => {
	    if (!data.status || data.status === 420) {
            const message = !data.status ? 'Користувача зареєстровано' : data.message
		    displayInfoErrorMessage('black', message);
		    setTimeout(() => setCurrentFormAndFormStepIndicator(), 2000);
        }
	    if (data.status === 421){
		    displayInfoErrorMessage('red', data.message)
            currentFormStep = 1;
	    }
    }

    const displayInfoErrorMessage = (color, message) => {
	    const errorMessage = document.querySelector('#show-user-error');
	    errorMessage.hidden = false;
	    errorMessage.style.color = color;
	    errorMessage.innerHTML = message;
    };

    checkDomainNameAvailability = () => {
	    let json = JSON.stringify({
        shopName : document.querySelector('#store-name').value,
        domain : document.querySelector('#domain-address').value
	    });
	    console.log('check domain availability', json);
	    const url = '/api/wizard/check-domain-name';
	    _generateRequest(url, json);
    }

    setShopContactInfo = () => {
	    let city = document.getElementById('city-name').value;
	    let street = document.getElementById('street-name').value;
	    let house = document.getElementById('house-number').value;
	    let json = JSON.stringify({city:city, street:street, house:house});
	    const url = '/api/wizard/shop-contact-info';
	    console.log('setShopContactInfo =>', url, json);
	    _generateRequest(url, json);
    }

    settingVariantsOfDeliveryAndPaymentTypes = () => {
	    const courier = document.querySelector('#courier').checked;
	    const post = document.querySelector('#post').checked;
	    const selftake = document.querySelector('#selftake').checked;

	    const deliveryVariantsError = document.querySelector('#handle-delivery-error');
	    const isSelectedDeliveryType = courier || post || selftake;

	    const cash = document.querySelector('#cash').checked;
	    const online = document.querySelector('#online-payment').checked;

	    const errorMessage = 'Виберіть один із варіантів';
	    deliveryVariantsError.innerText = isSelectedDeliveryType ? '' : errorMessage;
	    if (!isSelectedDeliveryType) return;

	    const toolInfo = {
		    courierDelivery: courier,
		    postDepartment: post,
		    selfTake: selftake,
        payCash: cash,
        payOnline: online
	    };
	    console.log('toolInfo', toolInfo);
	    const bodyParams = JSON.stringify(toolInfo);

	    _generateRequest(urlForDeliveryPaymentType, bodyParams);


    }


    _generateRequest = (url, json) => {
	    let token = localStorage.getItem('JWT_TOKEN');
	    const isUrlEqualDelivPayType = url == urlForDeliveryPaymentType;
	    console.log("check isUrlEqualDelivPayType for creating shop: ", isUrlEqualDelivPayType);
	    fetch(url, {
		    method: 'POST',
		    body: json,
		    headers: {
			    authorization: 'Bearer ' + token
		    }
	    }).then(response => {
		    console.log("response response: ", response);
		    return response.json();
	    }).then(data => {
		    console.log("response to prepare for creating shop: ", data);
		    handlingErrorForCurrentForm(data);
		    if (data && isUrlEqualDelivPayType) {
			    setTimeout(() => generateRequestForCreatingShop().then(() => window.location = '/dashboard'),10000);
		    }
	    });
    }

    generateRequestForCreatingShop = () => {
	    let token = localStorage.getItem('JWT_TOKEN');
	    const fetchRequest = fetch('/api/dashboard/shop/create', {
		    method: 'POST',
		    headers: {
			    authorization: 'Bearer ' + token
		    }
	    }).then(response =>{
		    console.log("response response: ", response);
		    return response.json();
	    }).then( data => {

	    });
	    return fetchRequest;
    }

    handlingErrorForCurrentForm = (data) => {
	    const containerError = document.getElementById('store-domain-error');
	    if (data.status === 103) {
		    setCurrentFormAndFormStepIndicator();
	    }
	    if (data.status === 421) {
		    containerError.style.display = 'block';
		    containerError.style.color = 'red';
		    containerError.innerText = data.message;
		    isValidateAddressDomainName = false;
	    }
	    if (!data.status || data.status === 420) {
		    containerError.style.display = "none";
		    isValidateAddressDomainName = true;
		    setCurrentFormAndFormStepIndicator();
	    }
    }

    showLoadingCircleAnimation = () => {
	    form.hidden = true;
	    circleLoadingAnimation.hidden = false;
    }

    let inputName = document.querySelector('#domain-address');
    let domainContainer = document.querySelector('.store-address-block');
    inputName.onkeyup = () => {
      domainContainer.hidden = false;
      document.querySelector('#store-domain-address').innerHTML = inputName.value + '.wstore.pro';
    };

    // function showError(input, message) {
    //     const formControl = input.parentElement;
    //     formControl.className = 'qr-form-input error';
    //     const errorMessage = formControl.querySelector('error-message');
    //     errorMessage.innerText = message;
    // }
    // function showSuccess(input) {
    //     const formControl = input.parentElement;
    //     formControl.className = 'qr-form-input success';
    // }
    // function checkEmail(input) {
    //     const re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
    //     if (re.test(input.value.trim())) {
    //         showSuccess(input);
    //     } else {
    //         showError(input, 'Email is not valid');
    //     }
    // }

</script>
    </body>
    </html>