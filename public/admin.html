<!DOCTYPE html>
<html lang="en">
<head>
    <script src="bower_components/webcomponentsjs/webcomponents-lite.js"></script>
    <meta charset="UTF-8">
    <title>HappyBag Admin</title>
    <link rel="import" href="bower_components/polymer/polymer.html">
    <link rel="import" href="bower_components/paper-datatable/paper-datatable.html">
    <link rel="import" href="bower_components/iron-ajax/iron-ajax.html">
    <link rel="import" href="bower_components/paper-dialog/paper-dialog.html">
    <link rel="import" href="bower_components/paper-dialog-scrollable/paper-dialog-scrollable.html">
    <link rel="import" href="bower_components/paper-button/paper-button.html">
    <link rel="import" href="bower_components/paper-input/paper-input.html">
    <link rel="import" href="bower_components/paper-input/paper-textarea.html">
</head>
<body>
<dom-module id="admin-view">
    <template>
        <style>
                #data {
                    width: 250px;
                    overflow: hidden;
                    white-space: nowrap;
                    text-overflow: ellipsis;
                }

                #data:hover{
                    overflow: visible;
                    white-space: normal;


                }
            </style>
        <iron-ajax
                auto
                url="/orders"
                handle-as="json"
                last-response="{{data}}">
        </iron-ajax>
        <paper-datatable id="datatable" data="{{data}}" selectable multi-selection>
            <paper-datatable-column header="П.І.П." property="name" type="String" sortable default="Не вказано"></paper-datatable-column>
            <paper-datatable-column header="Сума замовлення" property="total" type="Number" sortable default="1"></paper-datatable-column>
            <paper-datatable-column header="Телефон" property="phone" type="String" sortable default="Не вказано"></paper-datatable-column>
            <paper-datatable-column header="Адреса"
                                    property="address"
                                    type="String"
                                    sortable
                                    default="Не вказано">
                                    style="min-width: 300px" cell-style="font-family:monospace;"
            </paper-datatable-column>
            <paper-datatable-column header="№ відділення" property="departmentNumber" type="String" sortable default="Не вказано"></paper-datatable-column>
            <paper-datatable-column header="Замовлення"
                                    property="orders"
                                    style="min-width: 300px" cell-style="font-family:monospace;"
                                    dialog
                                    edit-icon
                                    type="Array"
                                    sortable
                                    format-value="{{formatVal}}"
                                    sort="{{customObjectSorter}}">
                <template>
                    <template is="dom-repeat" items="{{value}}">
                        <p>{{item.quantity}} шт. {{item.title}}<p>
                    </template>
                </template>
            </paper-datatable-column>
            <paper-datatable-column header="Статус замовлення" property="status" type="String" sortable default="Нове"></paper-datatable-column>
        </paper-datatable>
    </template>
    <script>
            (function() {
                'use strict';

                Polymer({
                    is: 'admin-view',

                    ready: function () {
                        this.formatVal = function(value){
                            return "Деталі";
                        };

                        this.customObjectSorter = function(a,b){
                            if(a.integer == b.integer){
                                if(a.string == b.string){
                                    return 0;
                                }else{
                                    return a.string < b.string ? -1 : 1;
                                }
                            }else{
                                return a.integer < b.integer ? -1 : 1;
                            }
                        };
                        this.retrieveResults = function(ev){
                            this.$.datatable.retrieveVisibleData();
                        };
                    }
                });
            })();
        </script>
</dom-module>
<admin-view></admin-view>
</body>
</html>